{{ block title }}

    Proportion estimates

{{ endblock }}

{{ block styles }}

  <style>

    body {
        margin: 0;
        font-size: 14px
    }

    table {
      margin: 20px auto; /* centers the table horizontally */
      border-collapse: collapse;
      text-align: center;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    th, td {
      border: 1px solid #ccc;
      padding: 10px 16px;         /* more breathing room */
      min-width: 80px;            /* makes columns more even */
      height: 48px;               /* taller cells */
    }

    th {
      background: #f5f5f5;
      font-weight: 600;
    }

    .total-row th,
    .total-row td {
      padding-top: 10px;
      padding-bottom: 10px;
    }

    .total-over {
      color: red;
      font-weight: bold;
    }

    .fraction-inline {
        display: inline-block;
        position: relative;
        width: 1.4em;   /* smaller square */
        height: 1.4em;
        font-size: 14px;
        margin-left: 8px;
        margin-right: 10px;
        vertical-align: middle;
      }

    .fraction-inline .diagonal-line {
        position: absolute;
        top: 50%;
        left: 50%;
        width: 140%;
        height: 1px;
        background: black;
        transform: translate(-50%, -50%) rotate(-45deg);
    }

    .fraction-inline .k-value {
        position: absolute;
        top: -3px;
        left: -5px;
        font-size: 0.9em;
        line-height: 1;
    }

    .fraction-inline .denominator {
        position: absolute;
        bottom: 0;
        right: -8px;
        font-size: 0.8em;
        line-height: 1;
    }

    .button-container {
        display: flex;
        justify-content: flex-end;
    }

    .submit-button {
        color: #fff;
        background-color: #007bff;
        border: 1px solid #007bff;
        font-size: 1rem;
        border-radius: 0.25rem;
        padding: 4px 12px;
        cursor: pointer;
        font-family: Arial, Helvetica, sans-serif;
        transition: background-color 0.2s ease, border-color 0.2s ease;
    }

    .submit-button:hover {
        background-color: #0056b3;
        border-color: #0056b3;
    }

    .submit-button:active {
        background-color: #004a99;
        border-color: #004a99;
    }


  </style>

{{ endblock }}

{{ block content }}

<html lang="en">
<head>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">


  <script>
      document.addEventListener("DOMContentLoaded", function () {
          // Parse backend list
          let sequence = JSON.parse('{{ sequence|json }}');
          if (!Array.isArray(sequence)) sequence = [];
          sequence.sort((a, b) => a - b);

          const tbody = document.getElementById('probability-table');
          const template = document.getElementById('prob-row-template');
          tbody.innerHTML = ''; // clear initial row

          // --- Build the input rows ---
          sequence.forEach(k => {
              const clone = template.cloneNode(true);
              clone.querySelector('.k-value').textContent = k;
              const input = clone.querySelector('input');
              input.name = `prop_${k}`;
              input.id = `prop_${k}`;
              tbody.appendChild(clone);
          });

          const inputs = Array.from(document.querySelectorAll('#probability-table input[type="number"]'));

          // --- Helpers ---
          function showError() {
              document.getElementById("error-message").style.display = "block";
          }

          function hideError() {
              document.getElementById("error-message").style.display = "none";
          }

          // --- Hide error when user starts filling ---
          inputs.forEach(input => {
              input.addEventListener('input', hideError);
          });

          // --- On submit ---
          $('#submit-button').on('click', function (e) {
              const allFilled = inputs.every(input => input.value.trim() !== "");

              if (!allFilled) {
                  e.preventDefault();
                  showError();
              } else {
                  $('form').submit();
              }
          });
      });
  </script>

</head>

<body>

<div  class="card-body">

  <p>
      Please state how many participants out of 100 (“the fraction”)
      you think chose to cooperate x times out of their 20 choices,
      for each number x below.
  </p>

    <table>
      <tbody id="probability-table">
      <tr id="prob-row-template">
        <th>
          <span class="fraction-inline">
            <span class="diagonal-line"></span>
            <span class="k-value">0</span>
            <span class="denominator">{{ C.number_of_trials }}</span>
          </span>
        </th>
        <td><input
          type="number"
          name="prop_0"
          id="prop_0"
          min="0"
          max="999"
          step="1"
          class="form-control form-control-sm text-center"
          style="max-width: 80px; margin: auto;"></td>
      </tr>
      </tbody>
    </table>

    <!-- Error message -->
    <div id="error-message" style="display: none; color: red; text-align: center;">
        Please make all decisions to continue.
    </div>

</div>

    <div class="button-container">
        <button type="submit" id="submit-button" class="submit-button">
            NEXT
        </button>
    </div>


</body>
</html>

{{ endblock }}
